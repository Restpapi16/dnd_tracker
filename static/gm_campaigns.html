<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <title>GM –ö–∞–º–ø–∞–Ω–∏–∏</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --font: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial;
            --bg: #000000; --surface: #070707; --surface2: #0b0b0b; --stroke: #242424; --stroke2: #303030;
            --text: #f8fafc; --muted: rgba(248, 250, 252, .66);
            --accent: #fbbf24; --accent2: #f59e0b; --onAccent: #111827;
            --danger: #ef4444; --danger2: #991b1b; --onDanger: #ffffff;
            --focus: rgba(251, 191, 36, .55);
        }
        body { font-family: var(--font); background: var(--bg); color: var(--text); margin: 0; padding: 14px 14px 108px; }
        .top-card { background: linear-gradient(180deg, #060606, #000000); border: 1px solid rgba(251, 191, 36, .55); border-radius: 14px; padding: 12px 14px; box-shadow: 0 0 0 1px rgba(0, 0, 0, .6), 0 10px 30px rgba(0, 0, 0, .55); }
        .top-title { color: var(--accent); font-weight: 900; font-size: 20px; }
        .top-sub { color: var(--muted); font-size: 14px; margin-top: 4px; }
        .section-title { font-size: 12px; text-transform: uppercase; letter-spacing: 0.10em; opacity: 0.7; margin: 10px 2px 8px; }
        .list { display: flex; flex-direction: column; gap: 10px; }
        .item { display: flex; align-items: center; justify-content: space-between; gap: 12px; padding: 14px; border-radius: 16px; background: linear-gradient(180deg, var(--surface), var(--surface2)); border: 1px solid #27272a; min-height: 58px; user-select: none; }
        .item:active { transform: scale(0.99); }
        .item-title { font-size: 16px; font-weight: 800; line-height: 1.2; }
        .item-sub { margin-top: 3px; font-size: 12px; color: var(--muted); }
        .pill { font-size: 12px; padding: 9px 12px; border-radius: 999px; border: 1px solid var(--stroke); background: rgba(37, 99, 235, .12); color: var(--text); white-space: nowrap; cursor: pointer; }
        .pill.ok { background: rgba(34, 197, 94, .12); } .pill.warn { background: rgba(245, 158, 11, .12); }
        .row-inline { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; margin-top: 10px; }
        .btn { height: 54px; padding: 0 16px; border-radius: 16px; border: 1px solid rgba(0, 0, 0, .55); background: linear-gradient(135deg, var(--accent), var(--accent2)); color: var(--onAccent); font-size: 14px; font-weight: 900; letter-spacing: .06em; text-transform: uppercase; cursor: pointer; box-shadow: 0 2px 6px rgba(15, 23, 42, 0.7); }
        .btn:active { transform: scale(0.99); }
        .btn.secondary { background: linear-gradient(135deg, #2a2a2a, #1d1d1d); color: var(--text); border: 1px solid var(--stroke2); }
        .btn.danger { background: linear-gradient(135deg, var(--danger), var(--danger2)); color: var(--onDanger); }
        .btn.has-attacks { background: linear-gradient(135deg, var(--accent), var(--accent2)); border: 2px solid var(--accent); animation: pulse 2s ease-in-out infinite; }
        @keyframes pulse { 0%, 100% { box-shadow: 0 0 8px rgba(251, 191, 36, 0.4); } 50% { box-shadow: 0 0 18px rgba(251, 191, 36, 0.7); } }
        .input { height: 54px; padding: 0 14px; border-radius: 16px; border: 1px solid var(--stroke2); background: #000; color: var(--text); font-size: 16px; outline: none; }
        .input.small { width: 92px; } .input.tiny { width: 56px; }
        .bottom-bar { position: fixed; left: 0; right: 0; bottom: 0; padding: 12px 14px calc(12px + env(safe-area-inset-bottom)); background: rgba(2, 6, 23, .92); backdrop-filter: blur(10px); border-top: 1px solid var(--stroke); z-index: 1500; }
        .bottom-row { display: flex; gap: 10px; } .bottom-row .input { flex: 1; }
        .hint { font-size: 12px; color: var(--muted); margin: 6px 2px 0; } .hint.warning { color: #fbbf24; font-weight: 700; }
        .toast { position: fixed; left: 50%; bottom: 18px; transform: translateX(-50%) translateY(20px); min-width: 220px; padding: 10px 14px; border-radius: 999px; background: rgba(15, 23, 42, 0.95); border: 1px solid #78350f; color: #f9fafb; font-size: 12px; text-align: center; opacity: 0; transition: opacity 0.25s, transform 0.25s; z-index: 2000; }
        .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
        .chips { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 10px; }
        .item.pick { transition: transform .05s, box-shadow .12s, border-color .12s, background .12s; }
        .item.pick.selected { border-color: var(--accent); box-shadow: 0 0 18px rgba(251, 191, 36, 0.30); background: radial-gradient(circle at top left, rgba(251, 191, 36, 0.16) 0, transparent 45%), linear-gradient(145deg, #0b0f18, #020617); }
        .attacks-section { margin-top: 12px; padding: 12px; background: rgba(15, 23, 42, 0.3); border-radius: 12px; border: 1px solid var(--stroke); }
        .attack-item { padding: 8px; margin-top: 6px; background: rgba(0, 0, 0, 0.4); border-radius: 8px; border: 1px solid var(--stroke); display: flex; justify-content: space-between; align-items: center; }
        .attack-info { flex: 1; }
        .attack-name { font-size: 13px; font-weight: 700; color: var(--text); }
        .attack-stats { font-size: 11px; color: var(--muted); margin-top: 2px; }
        .dice-group { display: flex; align-items: center; gap: 6px; }
        .dice-separator { font-size: 18px; font-weight: 900; color: var(--accent); }
        .setup-block { margin-top: 20px; padding: 14px; background: rgba(15, 23, 42, 0.2); border-radius: 16px; border: 1px solid var(--stroke); }
        .setup-block.players { border-color: rgba(37, 99, 235, .35); background: rgba(37, 99, 235, 0.08); }
        .setup-block.unique { border-color: rgba(220, 38, 38, .35); background: rgba(220, 38, 38, 0.08); }
        .setup-block.groups { border-color: rgba(245, 158, 11, .35); background: rgba(245, 158, 11, 0.08); }
    </style>
</head>
<body>
    <div id="toast" class="toast"></div>

    <div id="screenCampaigns">
        <div class="top-card"><div class="top-title">üé≠ GM –ö–∞–º–ø–∞–Ω–∏–∏</div><div class="top-sub" id="topSubtitle">–í–∞—à–∏ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è</div></div>
        <div class="section-title">–°–ø–∏—Å–æ–∫ –∫–∞–º–ø–∞–Ω–∏–π</div>
        <div id="campaignList" class="list"></div>
        <div class="section-title">–ú–æ–∏ —Å—Ö–≤–∞—Ç–∫–∏</div>
        <div id="myEncountersList" class="list"></div>
        <div class="hint">–°–æ–∑–¥–∞–Ω–∏–µ ‚Äî —Å–Ω–∏–∑—É. –¢–∞–ø –ø–æ –∫–∞–º–ø–∞–Ω–∏–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π.</div>
        <button class="btn secondary" style="width: 100%; margin-top: 14px;" onclick="goHome()">üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</button>
        <div class="bottom-bar"><div class="bottom-row"><input id="newCampaignName" class="input" type="text" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏–∏"><button id="createCampaignBtn" class="btn">–°–æ–∑–¥–∞—Ç—å</button></div></div>
    </div>

    <div id="screenCharacters" style="display:none;">
        <div class="top-card"><div class="top-title" id="campaignTitle">–ö–∞–º–ø–∞–Ω–∏—è</div><div class="top-sub" id="campaignSubtitle">–ü–µ—Ä—Å–æ–Ω–∞–∂–∏</div></div>
        <div class="section-title">–ü–µ—Ä—Å–æ–Ω–∞–∂–∏</div>
        <div id="characterList" class="list"></div>
        <div class="chips"><button id="startSetupBtn" class="btn">–°—Ö–≤–∞—Ç–∫–∞</button><button class="btn secondary" id="backToCampaignsBtn">‚Üê –ö–∞–º–ø–∞–Ω–∏–∏</button></div>
        <div class="bottom-bar"><div class="bottom-row" style="flex-wrap:wrap;"><input id="newCharName" class="input" type="text" placeholder="–ò–º—è"><input id="newCharAC" class="input small" type="number" placeholder="–ö–î"><input id="newCharInit" class="input small" type="number" placeholder="–ò–ù–ò–¶"><button id="createCharBtn" class="btn">–î–æ–±–∞–≤–∏—Ç—å</button></div></div>
    </div>

    <div id="screenEncounterSetup" style="display:none;">
        <div class="top-card"><div class="top-title" id="encSetupTitle">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å—Ö–≤–∞—Ç–∫–∏</div><div class="top-sub" id="encSetupSubtitle">–í—ã–±–µ—Ä–∏—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</div></div>
        <div class="setup-block players"><div class="section-title" style="margin-top:0;">üõ°Ô∏è –ò–≥—Ä–æ–∫–∏ –∫–∞–º–ø–∞–Ω–∏–∏</div><div id="encPlayersList" class="list"></div></div>
        
        <div class="setup-block unique">
            <div class="section-title" style="margin-top:0;">üëπ –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –º–æ–±—ã</div>
            <div id="encUniqueMonsters" class="list"></div>
            <div class="row-inline"><input id="uniqueName" class="input" type="text" placeholder="–ò–º—è"><input id="uniqueHP" class="input small" type="number" placeholder="–•–ü"><input id="uniqueAC" class="input small" type="number" placeholder="–ö–î"><input id="uniqueInitMod" class="input small" type="number" placeholder="–ò–ù–ò–¶+"><button id="addUniqueBtn" class="btn secondary">+ –ú–æ–±</button></div>
            <div id="uniqueAttacksSection" class="attacks-section" style="display:none;">
                <div class="section-title" style="margin: 0 0 8px 0;">‚öîÔ∏è –ê—Ç–∞–∫–∏ –º–æ–±–∞</div>
                <div class="row-inline"><input id="uniqueAttackName" class="input" type="text" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∞—Ç–∞–∫–∏" style="flex:1;"><input id="uniqueAttackHitBonus" class="input small" type="number" placeholder="+–ü–æ–ø–∞–¥"></div>
                <div class="row-inline" style="margin-top: 6px;">
                    <div class="dice-group"><input id="uniqueAttackDmgDice" class="input tiny" type="number" placeholder="2"><span class="dice-separator">d</span><input id="uniqueAttackDmgDie" class="input tiny" type="number" placeholder="6"><span class="dice-separator">+</span><input id="uniqueAttackDmgBonus" class="input tiny" type="number" placeholder="3"></div>
                    <input id="uniqueAttackDmgType" class="input" type="text" placeholder="–¢–∏–ø —É—Ä–æ–Ω–∞" style="flex:1;">
                </div>
                <div class="row-inline" style="margin-top: 6px;"><input id="uniqueAttackRange" class="input" type="text" placeholder="–î–∞–ª—å–Ω–æ—Å—Ç—å (—Ñ—É—Ç–æ–≤)" style="flex:1;"><button id="addUniqueAttackBtn" class="btn secondary">+ –ê—Ç–∞–∫–∞</button></div>
                <div id="uniqueAttacksList"></div>
            </div>
            <button id="toggleUniqueAttacksBtn" class="btn secondary" style="width: 100%; margin-top: 8px;">‚öîÔ∏è –ê—Ç–∞–∫–∏ (0)</button>
            <div id="uniqueAttacksHint" class="hint" style="display:none;"></div>
        </div>

        <div class="setup-block groups">
            <div class="section-title" style="margin-top:0;">üë• –ì—Ä—É–ø–ø—ã –º–æ–±–æ–≤</div>
            <div id="encGroupMonsters" class="list"></div>
            <div class="row-inline"><input id="groupName" class="input" type="text" placeholder="–ò–º—è –≥—Ä—É–ø–ø—ã"><input id="groupCount" class="input small" type="number" placeholder="xN"><input id="groupHP" class="input small" type="number" placeholder="–•–ü"><input id="groupAC" class="input small" type="number" placeholder="–ö–î"><input id="groupInitMod" class="input small" type="number" placeholder="–ò–ù–ò–¶+"><button id="addGroupBtn" class="btn secondary">+ –ì—Ä—É–ø–ø–∞</button></div>
            <div id="groupAttacksSection" class="attacks-section" style="display:none;">
                <div class="section-title" style="margin: 0 0 8px 0;">‚öîÔ∏è –ê—Ç–∞–∫–∏ –≥—Ä—É–ø–ø—ã</div>
                <div class="row-inline"><input id="groupAttackName" class="input" type="text" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∞—Ç–∞–∫–∏" style="flex:1;"><input id="groupAttackHitBonus" class="input small" type="number" placeholder="+–ü–æ–ø–∞–¥"></div>
                <div class="row-inline" style="margin-top: 6px;">
                    <div class="dice-group"><input id="groupAttackDmgDice" class="input tiny" type="number" placeholder="2"><span class="dice-separator">d</span><input id="groupAttackDmgDie" class="input tiny" type="number" placeholder="6"><span class="dice-separator">+</span><input id="groupAttackDmgBonus" class="input tiny" type="number" placeholder="3"></div>
                    <input id="groupAttackDmgType" class="input" type="text" placeholder="–¢–∏–ø —É—Ä–æ–Ω–∞" style="flex:1;">
                </div>
                <div class="row-inline" style="margin-top: 6px;"><input id="groupAttackRange" class="input" type="text" placeholder="–î–∞–ª—å–Ω–æ—Å—Ç—å (—Ñ—É—Ç–æ–≤)" style="flex:1;"><button id="addGroupAttackBtn" class="btn secondary">+ –ê—Ç–∞–∫–∞</button></div>
                <div id="groupAttacksList"></div>
            </div>
            <button id="toggleGroupAttacksBtn" class="btn secondary" style="width: 100%; margin-top: 8px;">‚öîÔ∏è –ê—Ç–∞–∫–∏ (0)</button>
            <div id="groupAttacksHint" class="hint" style="display:none;"></div>
        </div>
        
        <div class="chips" style="margin-top:20px;"><button id="startEncounterBtn" class="btn">–ù–∞—á–∞—Ç—å</button><button class="btn secondary" id="backToCharsBtn">‚Üê –ü–µ—Ä—Å–æ–Ω–∞–∂–∏</button></div>
    </div>

    <script src="/static/gm_campaigns.js"></script>
</body>
</html>