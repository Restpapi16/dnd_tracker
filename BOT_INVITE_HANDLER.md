# –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–Ω–≤–∞–π—Ç-—Å—Å—ã–ª–æ–∫ –≤ Telegram –±–æ—Ç–µ

## –®–∞–≥ 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ /start

–î–æ–±–∞–≤—å—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã `/start` –≤–∞—à–µ–≥–æ –±–æ—Ç–∞:

```python
from aiogram import Router, F
from aiogram.filters import Command
from aiogram.types import Message, InlineKeyboardMarkup, InlineKeyboardButton, WebAppInfo

router = Router()

@router.message(Command("start"))
async def cmd_start(message: Message):
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∞—Ä–≥—É–º–µ–Ω—Ç –ø–æ—Å–ª–µ /start
    args = message.text.split(maxsplit=1)
    
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–Ω–≤–∞–π—Ç-—Å—Å—ã–ª–∫–∏
    if len(args) > 1 and args[1].startswith("invite_"):
        # –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–æ–∫–µ–Ω (—É–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å "invite_")
        invite_token = args[1].replace("invite_", "")
        
        # URL –≤–∞—à–µ–≥–æ WebApp (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à –¥–æ–º–µ–Ω)
        webapp_url = f"https://your-domain.com/static/join.html?token={invite_token}"
        
        # –°–æ–∑–¥–∞—ë–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å WebApp –∫–Ω–æ–ø–∫–æ–π
        keyboard = InlineKeyboardMarkup(inline_keyboard=[
            [InlineKeyboardButton(
                text="üîó –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∫–∞–º–ø–∞–Ω–∏–∏",
                web_app=WebAppInfo(url=webapp_url)
            )]
        ])
        
        await message.answer(
            "üé≤ –¢–µ–±—è –ø—Ä–∏–≥–ª–∞—Å–∏–ª–∏ –≤ D&D –∫–∞–º–ø–∞–Ω–∏—é!\n\n"
            "–ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫–∞–∫ –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—å.",
            reply_markup=keyboard
        )
        return
    
    # –û–±—ã—á–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ /start (–µ—Å–ª–∏ –Ω–µ—Ç –∏–Ω–≤–∞–π—Ç–∞)
    await message.answer(
        "üé≤ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ D&D Tracker!\n\n"
        "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:",
        reply_markup=main_menu_keyboard()  # –í–∞—à–∞ –æ–±—ã—á–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞
    )
```

---

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

### 1. GM —Å–æ–∑–¥–∞—ë—Ç –∏–Ω–≤–∞–π—Ç-—Å—Å—ã–ª–∫—É –≤ WebApp:
- –ù–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É üì§ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è" —Ä—è–¥–æ–º —Å –∫–∞–º–ø–∞–Ω–∏–µ–π
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Å—Å—ã–ª–∫–∞ –≤–∏–¥–∞: `https://t.me/your_bot?start=invite_ABC123XYZ`

### 2. –î—Ä—É–≥ –Ω–∞–∂–∏–º–∞–µ—Ç –Ω–∞ —Å—Å—ã–ª–∫—É:
- –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –±–æ—Ç —Å –∫–æ–º–∞–Ω–¥–æ–π `/start invite_ABC123XYZ`
- –ë–æ—Ç –≤–∏–¥–∏—Ç –ø—Ä–µ—Ñ–∏–∫—Å `invite_` –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç WebApp

### 3. WebApp –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ:
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ `join.html` –ø–æ–ª—É—á–∞–µ—Ç —Ç–æ–∫–µ–Ω –∏–∑ URL
- –î–µ–ª–∞–µ—Ç POST –∑–∞–ø—Ä–æ—Å –∫ API: `/campaigns/join` —Å —Ç–æ–∫–µ–Ω–æ–º
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫–∞–∫ observer –≤ –∫–∞–º–ø–∞–Ω–∏—é
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ

### 4. Observer —Å–º–æ—Ç—Ä–∏—Ç —Å—Ö–≤–∞—Ç–∫–∏:
- –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Ä–∞–∑–¥–µ–ª "–ú–æ–∏ –∫–∞–º–ø–∞–Ω–∏–∏" (observer mode)
- –í–∏–¥–∏—Ç —Å–ø–∏—Å–æ–∫ –∫–∞–º–ø–∞–Ω–∏–π, –≥–¥–µ –æ–Ω –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—å
- –í—ã–±–∏—Ä–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω—É—é —Å—Ö–≤–∞—Ç–∫—É –∏ –Ω–∞–±–ª—é–¥–∞–µ—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

---

## –ß—Ç–æ –≤–∏–¥–∏—Ç Observer –≤ —Å—Ö–≤–∞—Ç–∫–µ:

‚úÖ **–í–∏–¥–Ω–æ:**
- –ò–º–µ–Ω–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- –ò–Ω–∏—Ü–∏–∞—Ç–∏–≤—É
- –ß–µ–π —Å–µ–π—á–∞—Å —Ö–æ–¥ (–ø–æ–¥—Å–≤–µ—Ç–∫–∞)
- –ñ–∏–≤/–º—ë—Ä—Ç–≤ —É—á–∞—Å—Ç–Ω–∏–∫
- –í—Ä–∞–≥ –∏–ª–∏ —Å–æ—é–∑–Ω–∏–∫
- –¢–µ–∫—É—â–∏–π —Ä–∞—É–Ω–¥

‚ùå **–ù–ï –≤–∏–¥–Ω–æ (—Å–∫—Ä—ã—Ç–æ –¥–ª—è –∏–Ω—Ç—Ä–∏–≥–∏):**
- HP (—Ç–µ–∫—É—â–∏–µ –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ)
- AC (–∫–ª–∞—Å—Å –¥–æ—Å–ø–µ—Ö–∞)
- –ê—Ç–∞–∫–∏ –º–æ–Ω—Å—Ç—Ä–æ–≤
- –£—Ä–æ–Ω

---

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç (–±–µ–∑ WebApp –∫–Ω–æ–ø–∫–∏):

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ —Å—Ä–∞–∑—É –æ—Ç–∫—Ä—ã–≤–∞—Ç—å WebApp –±–µ–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è:

```python
@router.message(Command("start"))
async def cmd_start(message: Message):
    args = message.text.split(maxsplit=1)
    
    if len(args) > 1 and args[1].startswith("invite_"):
        invite_token = args[1].replace("invite_", "")
        
        # –ü—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ/WebView
        direct_link = f"https://your-domain.com/static/join.html?token={invite_token}"
        
        await message.answer(
            f"üé≤ –¢–µ–±—è –ø—Ä–∏–≥–ª–∞—Å–∏–ª–∏ –≤ D&D –∫–∞–º–ø–∞–Ω–∏—é!\n\n"
            f"–ù–∞–∂–º–∏ –Ω–∞ —Å—Å—ã–ª–∫—É –¥–ª—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:\n"
            f"{direct_link}"
        )
        return
    
    # –û–±—ã—á–Ω—ã–π /start
    await message.answer("–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ D&D Tracker!")
```

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞:

1. –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é –∫–∞–º–ø–∞–Ω–∏—é
2. –ù–∞–∂–º–∏—Ç–µ üì§ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è"
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–∫—É
4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –¥—Ä—É–≥—É –∏–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –≤ –¥—Ä—É–≥–æ–º –∞–∫–∫–∞—É–Ω—Ç–µ
5. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## Troubleshooting:

**–ü—Ä–æ–±–ª–µ–º–∞:** –ë–æ—Ç –Ω–µ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ `/start invite_XXX`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ —Ä–æ—É—Ç–µ—Ä–µ
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ `message.text.split()`

**–ü—Ä–æ–±–ª–µ–º–∞:** WebApp –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ–º–µ–Ω –≤ `webapp_url` (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å HTTPS)
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–æ–º–µ–Ω –¥–æ–±–∞–≤–ª–µ–Ω –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ @BotFather

**–ü—Ä–æ–±–ª–µ–º–∞:** –û—à–∏–±–∫–∞ "Invalid token"
- –¢–æ–∫–µ–Ω –º–æ–≥ –∏—Å—Ç–µ—á—å (—Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: 7 –¥–Ω–µ–π)
- –ü–æ–ø—Ä–æ—Å–∏—Ç–µ GM —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—É—é —Å—Å—ã–ª–∫—É
